<analysis>
The trajectory details a significant evolution of a CRM application, starting with a fundamental architectural refactoring. The initial task was to separate Customer Prospects from Customers, which involved moving from a single  collection with an  boolean flag to two distinct collections:  and . This required creating new backend models and API endpoints (), a data migration script, and extensively modifying the frontend to use the new endpoints for creating, listing, deleting, and converting leads.

A substantial portion of the work involved debugging the Convert Lead to Customer flow. This debugging journey uncovered several critical issues:
1.  A hardcoded database name in a new route file () caused converted customers to be saved to a different database than the one the main application was reading from.
2.  After fixing the database issue, the frontend lists didn't update automatically. This was resolved by implementing a state-refresh pattern, passing a  callback function from the root  component down to child components that perform data mutations.
3.  Multiple UI bugs were identified and fixed, including a critical performance issue caused by using  in a render method, which led to flickering numbers on hover.

Following the core refactoring, new features were added, such as managing customer statuses (passive, favorite) and creating a new Projects module with a complex form. The latest work was on the All Fairs page, fixing data display issues, before the user requested a new, large-scale feature: a SaaS landing page and an Ultra Admin panel. The user's primary language is Turkish. The next agent must respond in Turkish.
</analysis>

<product_requirements>
The product is a comprehensive CRM application designed to manage the entire customer lifecycle, from lead generation to project management.

**Core Functionality Implemented:**
*   **Lead vs. Customer Segregation:** The system distinctly separates Müşteri Adayları (Leads) from Müşteriler (Customers) into separate database collections and manages them through dedicated UI sections.
*   **Lead-to-Customer Conversion:** A complete workflow allows users to convert a lead into a customer. This action updates the lead's status and creates a new entry in the customers' database. The UI automatically refreshes to reflect this change.
*   **Customer Management:** Users can create, view, and list customers. A system for managing customer status (e.g., active, passive) and marking them as favorite has been implemented, with dedicated pages for filtering these views.
*   **Project Inception:** A new Projects module has been initiated. This includes a New Project form with advanced features like customer selection, dynamic fair selection (with an add new fair modal), and a complex, dynamic payment terms builder.
*   **Fairs Management:** A page to list all fairs, with custom columns showing associated city, country, and the number of customers.

**Pending High-Level Requests:**
*   A full-featured SaaS landing page, similar to .
*   An Ultra Admin panel for high-level system management.
</product_requirements>

<key_technical_concepts>
*   **Frontend**: React (Hooks: , , ), React Router, Prop-based state management (passing  callback for list re-fetching), Tailwind CSS.
*   **Backend**: FastAPI (Pydantic models, APIRouter), MongoDB (using Motor async driver).
*   **Architecture**: Monorepo structure. Key architectural decision was refactoring from a single  collection with an  flag to separate  and  collections to improve data segregation and scalability. UUIDs are used for IDs.
*   **Environment**: Vite build tool for frontend, with environment variables () being critical for API communication.
</key_technical_concepts>

<code_architecture>
The application is a monorepo with a React frontend and a FastAPI backend.



*   ** (New File)**
    *   **Importance**: Encapsulates all backend logic for leads (create, list, delete, convert). This separates concerns from the main .
    *   **Changes**: Created to handle the new  collection. A critical bug was fixed here where a database name was hardcoded, causing data inconsistency. It now correctly uses the database from the environment configuration.

*   ****
    *   **Importance**: The main FastAPI application file. It defines all primary API routes and models.
    *   **Changes**: Updated to include routers from  and . New endpoints were added to manage customer status () and to fetch fairs with associated customer counts.

*   ****
    *   **Importance**: The root component that manages main application state (like the master list of customers) and routing.
    *   **Changes**: The  function was created to fetch all customers. This function is passed down as a  prop to child components, enabling them to trigger a global state refresh after data mutations (e.g., after creating a customer or converting a lead). Routes for new pages like  and  were added.

*   ****
    *   **Importance**: The UI for managing leads.
    *   **Changes**: Completely refactored to fetch data from  instead of . The convert functionality was updated to call the new conversion endpoint and then trigger the  prop to update the main customer list automatically. A filter was added to hide leads with .

*   ****
    *   **Importance**: The UI for listing active customers.
    *   **Changes**: A critical bug was fixed by removing  from the render logic, which caused flickering numbers. Logic was added to implement the Set to Passive feature by calling the new backend endpoint and triggering a list refresh. A filter was added to only show customers with .

*   ****
    *   **Importance**: The UI for listing all fairs and their associated data.
    *   **Changes**: This file was heavily modified to replace the old implementation. It now fetches data from a new backend endpoint () and displays columns for Şehir (City), Ülke (Country), and Müşteri (Customer count) as requested by the user. The current work is focused on fixing a bug in this file where City/Country data is not displaying correctly.

*   ** (New File)**
    *   **Importance**: A new, complex form for creating projects, central to the new Projects module.
    *   **Changes**: Created from scratch based on detailed user requirements. It features a layout consistent with , includes child components like , and fetches and displays a list of customers for selection.
</code_architecture>

<pending_tasks>
- **High-Level Features:**
  - Build a new SaaS landing page for Vitingo CRM, inspired by .
  - Develop an Ultra Admin panel for system administration.
- **Fairs Page Enhancements:**
  - Implement filters for city, country, and month on the All Fairs page.
  - Add a search bar to the All Fairs page.
</pending_tasks>

<current_work>
The immediate focus is on debugging the **Tüm Fuarlar (All Fairs) page** located at .

The user reported two issues:
1.  **Missing Data:** For a fair named Euroshop, the Şehir (City) and Ülke (Country) columns were showing as -, even though the data was entered. The backend API response () confirms that the city and country data is being sent. The bug lies in the frontend rendering logic within .
2.  **Missing Functionality:** The user requested filters (city, country, month) and a search bar for this page.

The previous engineer's last action was to modify  to correctly reference  and  instead of  and . A  was also added to inspect the  data object in the browser to diagnose why the values weren't rendering. The user then interrupted with a request to build a new landing page, and the engineer correctly decided to resolve the current bug first.
</current_work>

<optional_next_step>
Fix the data display bug on the All Fairs page () by inspecting the console logs to see why  and  are not rendering, and then implement the necessary correction.
</optional_next_step>
