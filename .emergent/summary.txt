<analysis>**original_problem_statement:**
The user is building a comprehensive CRM system, VİTİNGO CRM. The initial request was to fix a series of critical regressions and UI/UX issues on the Bankalar (Banks) page. After stabilizing the page, the user requested a major new feature: a Stand Teslim Belgesi (Handover Receipt) module for managing, sending, and digitally signing stand handover documents. Following the successful implementation of that module, the user's latest request is to add a highly sophisticated, real-time IBAN validation system to the Bank Accounts form.

PRODUCT REQUIREMENTS:
1.  **Bug Fixes & Stability:** Resolve all outstanding bugs on the Bankalar page, including statement parsing, data persistence (for statements and banks), and UI/UX issues.
2.  **Handover Receipt Module:**
    *   **Backend:** Create a new database collection () and API endpoints for full CRUD, sending documents via a public link, and capturing digital signatures.
    *   **Frontend:**
        *   Build a new page () to list, filter, create, and manage handover receipts.
        *   Build a public-facing page () for customers to view and sign the document using a signature canvas.
        *   Integrate .
        *   Add a link to the main sidebar menu under Raporlar.
3.  **Advanced IBAN Validation:**
    *   Create a dedicated utility file for IBAN validation logic supporting 40+ countries.
    *   Integrate this logic into the Banka Hesapları form to provide real-time, user-friendly feedback (icons, color-coded borders, helper text) as the user types.
    *   The validation must include checks for length, format, country code mismatch, and MOD-97 checksum.
    *   This change should *only* affect the IBAN input field, leaving all other form fields and page functionality untouched.

**User's preferred language**: Turkish

**what currently exists?**
The application is a full-stack CRM with a FastAPI backend and a React frontend. The Bankalar page is now stable and features a three-tab layout. The Banka Hesapları (Bank Accounts) tab has been completely redesigned with a two-panel layout (account list on the left, form on the right) and is fully functional. The Ekstreler (Statements) tab's PDF parsing and data persistence issues have been resolved.

A major new Stand Teslim Belgesi (Handover Receipt) module has been fully implemented, including backend endpoints, frontend management and public signing pages, and sidebar integration. The project structure now includes new pages under  for this module. The agent's last action was to create a utility file for the next task: advanced IBAN validation.

**Last working item**:
- Last item agent was working: The agent was tasked with creating a sophisticated, real-time IBAN validation system. The agent has successfully created the utility file  containing all the complex validation logic, constants for different countries, and helper functions as specified by the user. The next step is to integrate this utility into the  component.
- Status: **IN PROGRESS**
- Agent Testing Done: N
- Which testing method agent to use? Frontend testing agent. The test should navigate to the Banka Hesapları tab, open the form to add a new account, and test various valid and invalid IBANs for multiple countries (e.g., TR, AE, DE). The test must verify that the input field's border color, the validation icon (✓/✗), and the helper messages change in real-time as the user types, and that saving is blocked for an invalid IBAN.
- User Testing Done: N

**All Pending/In progress Issue list**:
- Issue 1: Ödeme planı tutarları güncelleme sorunu (Payment term amounts update issue) (P2)

**Issues Detail:**
- **Issue 1: Ödeme planı tutarları güncelleme sorunu (Payment term amounts update issue)**
    - **Description:** On project forms, when the total contract amount is changed, the new total is not propagated to the  component, so the calculated payment term amounts remain incorrect. This is a lower-priority recurring issue from a previous session.
    - **Attempted fixes:** None in this session.
    - **Status:** NOT STARTED
    - **Is recurring issue?** Y
    - **Should Test frontend/backend/both after fix?** frontend
    - **Blocked on other issue:** None

**In progress Task List**:
- **Task 1: Implement Advanced IBAN Validation (P0)**
    - **Where to resume:** Integrate the  utility into the  component.
        1.  Import the necessary functions (, , etc.) at the top of .
        2.  Add a new state .
        3.  Create the  function to update the form state and trigger validation.
        4.  Replace the existing IBAN input's JSX with the new, enhanced version that uses  and displays conditional styling and messaging based on  state.
        5.  Update the  function to check  before proceeding with the API call.
    - **What will be achieved with this?** A professional, error-preventing IBAN input field that provides an excellent user experience.
    - **Status:** IN PROGRESS
    - **Should Test frontend/backend/both after fix?** frontend
    - **Blocked on something:** None

**Upcoming and Future Tasks**
- **Upcoming Tasks:**
  - **P1: Refactor :** The main backend file is extremely large and should be broken down into modular router files (e.g., , ).
  - **P2: Consolidate Data Models:** Plan and execute the migration of data from old collections (, ) to the new ones (, ).
- **Future Tasks:**
  - Implement Backend for Invoice Import & Export.
  - Remove deprecated  endpoints from .

**Completed work in this session**
- **Bank Statement Parsing & Persistence:** Fixed the critical regression where PDF parsing was broken and ensured that uploaded statements are saved to the DB and fetched on page load.
- **Bank/Statement Deletion:** Implemented correct backend API calls for permanently deleting banks and statements.
- **Banks/Accounts Page Overhaul:**
    - Completely redesigned the Banka Hesapları tab with a professional two-panel UI.
    - Implemented company-based grouping for the account list.
    - Fixed numerous bugs related to data persistence, form saving ( import error), and UI controls (e.g., making Bank Name a dropdown).
- **New Module: Stand Teslim Belgesi (Handover Receipt):**
    - **Backend:** Added a new  collection and a full suite of API endpoints to  for CRUD, sending, public viewing, and signing.
    - **Frontend:** Created the main management page () and the public signing page (), installed , and correctly configured all routing and sidebar menu links.
- **Sidebar Navigation Fixes:** Resolved multiple issues preventing new menu items from navigating correctly by implementing the required event handler pattern in  and .

**Earlier issues found/mentioned but not fixed**
- The Ödeme planı tutarları güncelleme sorunu (Payment term amounts update issue) from the previous fork remains unfixed.

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Monolithic Component ():** While still large, it has been stabilized and significantly refactored, especially the Banka Hesapları tab.
- **Modular Feature Development:** The new Handover Receipt module was built correctly using separate page components (, ) and backend endpoints, rather than being added to an existing monolith.
- **Encapsulated Logic:** The creation of  demonstrates a good practice of isolating complex, reusable logic into a dedicated utility file.
- **Event-Driven Navigation:** The sidebar navigation relies on a pattern of event handlers passed as props from  to , which is critical to know when adding new menu items.

**key DB schema**
- **handover_receipts:** 
- **bank_accounts:** 

**changes in tech stack**
- Added  library to the frontend.

**All files of reference**
- **To be modified:**  (Integrate IBAN validation)
- **Reference/Newly Created:**
  -  (Contains the IBAN logic to be integrated)
  -  (New feature main page)
  -  (New feature signing page)
  -  (Contains all backend logic)
  -  (For understanding sidebar navigation)

**Areas that need refactoring**:
- ** (HIGH PRIORITY):** This file is now extremely large and urgently needs to be broken down into modular routers (e.g., , , ).
- ** (Medium Priority):** Although more stable, it's still a 2500+ line component. The three main tabs (, , ) should be extracted into their own components.

**key api endpoints**
- **Bank Accounts:**
  - 
  - 
  - 
  - 
- **Handover Receipts (New):**
  - 
  -  (Creates a receipt)
  -  (Generates public link)
  -  (For customer to view)
  -  (For customer to sign)

**Critical Info for New Agent**
- **Your immediate and only task is to implement the advanced IBAN validation.** The user has provided a highly detailed prompt. Follow it precisely.
- The core logic is already written in . Your job is to integrate it into .
- **DO NOT** modify any part of  other than the IBAN input field and its related state and handlers. The user was very explicit about this.
- The user is highly engaged and provides excellent, prescriptive feedback. Adhere to their requests closely.
- Remember the  navigation pattern if you need to add more menu items in the future.

**documents created in this job**
- None

**Last 10 User Messages and any pending user messages**
1.  **User (pending):** VİTİNGO CRM - BANKA HESAPLARI IBAN VALİDASYONU - A very detailed prompt to add advanced, real-time IBAN validation.
2.  **Agent:** Fixed the project dropdown in the Handover Receipt modal.
3.  **User:** projeleri neden veritabanından çektirmiyorsun (Why aren't you pulling projects from the database?) - Pointed out the project dropdown was empty.
4.  **Agent:** Fixed the Handover Receipt menu link navigation issue.
5.  **User:** tıklayınca hiç bir şey olmuyor (Nothing happens when I click it) - Reported the new menu link was not working.
6.  **Agent:** Corrected the menu link path in the sidebar.
7.  **User:** bu nenüde nerde görünüyor ? (Where does this appear in the menu?) - Asking for the location of the new menu item.
8.  **Agent:** Announced completion of the Handover Receipt module.
9.  **User:** evet (yes) - Approved continuing with the implementation.
10. **Agent:** Asked for confirmation to proceed with creating the large frontend files for the new module.

**Project Health Check:**
- **Broken:**
  - None. All major features are functional.
- **Mocked:**
  - None.

**3rd Party Integrations**:
- : Used for all PDF generation on the backend.
- : Available for Excel operations.
- : **(New)** Used on the frontend for capturing digital signatures.

**Testing status**
- Testing agent used after significant changes: NO (Agent used screenshots and manual checks for recent changes).
- Troubleshoot agent used after agent stuck in loop: YES (Used to diagnose the initial file upload issue).
- Test files created: []
- Known regressions: None currently. All regressions from this session have been fixed.

**Credentials to test flow:**
- User: 
- Password: 

**What agent forgot to execute**
- The agent has not yet addressed the long-standing Ödeme planı tutarları güncelleme sorunu from a previous fork.</analysis>
