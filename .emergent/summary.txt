<analysis>
The AI engineer significantly expanded the Vitingo CRM across multiple modules. Initially, a new Brief system was integrated, adding navigation and basic form structure. The core focus then shifted to extensively overhauling the Yeni Müşteri Ekle (New Customer Form) with dynamic fields, complex dropdowns, and country/city integrations. This involved prolonged debugging of React infinite loop errors (), eventually resolved with  identifying a state update conflict. Subsequently, customer persistence was addressed by implementing full CRUD API endpoints in the backend (FastAPI/MongoDB) and integrating them into the frontend. A critical frontend environment variable issue ( undefined) was fixed by standardizing to . Finally, an automatic customer classification system for Pasif Müşteriler (Inactive) and Favori Müşteriler (Favorite) based on invoice activity was introduced, currently being implemented into the UI. The latest task involves conditionally rendering specific fields for Türkiye in the new customer form.
</analysis>

<product_requirements>
The Vitingo CRM aims for an intuitive, graphic-rich interface, expanding its MVP dashboard. Key requirements and implementation status:
1.  **User Management**: Admin-restricted New User form, real user data, role definitions, password changes, actions (Delete, Share, Message, Email), Super Admin user creation, Kullanıcı Yönetimi in header dropdown, Login As for Super Admins.
2.  **Fair Management**: Fuarlar menu with sub-menus and Yeni Fuar form.
3.  **Data Import/Export**: Under Ayarlar with category dropdowns.
4.  **Sales Opportunity Integration**: Dynamic Fuar Adı dropdown in Yeni Satış Fırsatı form.
5.  **Dashboard Redesign**: Modern KPIs, charts, maps, multi-currency, real-time survey stats. Logout moved to header.
6.  **Customer Survey System**: Post-project surveys with multi-project, arbitrary email, and rep filtering.
7.  **Handover Form System**: Digital forms, language, signature, automatic survey upon completion.
8.  **Accounting System**: Muhasebe menu, Yeni Fatura form with unique numbering, currency, item lines, KDV, discount, totals, localStorage persistence.
9.  **Messaging System**: In-app messaging, notification bell.
10. **Brief System (New)**: Brief menu with sub-items (Yeni Brief, Tüm Briefler, Kapanmış, Pasif, Brief Talep Et) implemented, with a comprehensive Yeni Brief form featuring dynamic customer/contact person selection and auto-fill.
11. **Customer Status Logic (New)**: Customers without invoices for 6+ months are Pasif, and those with 3+ invoices in a year are Favori, displayed on respective pages.
12. **New Customer Form Enhancements**: Overhauled form with dynamic İletişim Kişisi, İlişki Tipi, detailed country/city selection, professional phone input, and conditional fields for Türkiye (Firma Unvanı, Vergi Daireleri, Vergi Numarası).
</product_requirements>

<key_technical_concepts>
-   **React**: Frontend framework.
-   **FastAPI/MongoDB**: Backend for API and data persistence (UUIDs for IDs).
-   **Shadcn UI/Tailwind CSS**: UI components and styling.
-   **React Router DOM**: Client-side routing.
-   **Context API**: Global state management (AuthContext).
-   **SendGrid**: Email sending service.
-   **LocalStorage**: Temporary persistence for users, invoices, notifications.
-   **Frontend Environment Variables**: Proper usage of  for API URLs.
-   **Troubleshooting**: Utilizing  for complex React debugging.
</key_technical_concepts>

<code_architecture>

-   ****: API endpoints, data processing.
    -   **Changes**: Updated  Pydantic model to reflect new form fields. Added comprehensive CRUD (Create, Read, Update, Delete) API endpoints for , ensuring data persistence.
-   ****: Core frontend routing and state.
    -   **Changes**: Integrated Brief system by adding  state,  related functions, and passing them to . Imported  and . Updated  to call backend API and added  to fetch customers from backend. Standardized environment variable access to . Passed  prop to  and .
-   ****: Main navigation.
    -   **Changes**: Added Brief menu with Yeni Brief, Tüm Briefler, Kapanmış, Pasif, and Brief Talep Et sub-items and their respective handlers.
-   ****: (New File) Form for creating new briefs.
    -   **Changes**: Implemented Temel Bilgiler, Etkinlik Bilgileri, Stand Gereksinimleri, Bütçe ve Gereksinimler sections. Added Müşteri dropdown using , with auto-fill for contact details from . Includes advanced/simple view toggle. Debugged and fixed multiple React infinite loop errors (Max Update Depth Exceeded) by refining  dependencies and state management.
-   ****: (New File) Displays all created briefs. (Initial implementation, placeholder content)
-   ****: Form for creating new customers.
    -   **Changes**: Underwent a major overhaul. Implemented dynamic İlişki Tipi (Relationship Type) and İletişim Kişisi (Contact Person) dropdowns with add new options. Redesigned phone input with narrowed country code, flags, and country names. Removed Bölge and added Ülke and dependent Şehir dropdowns using . Implemented Sektör (Sector) dropdown with add new option. Resolved multiple Maximum update depth exceeded errors by isolating phone country code into a separate state and carefully managing  dependencies. Currently being updated to conditionally show fields for Türkiye.
-   ****: (New File) Centralized data for countries and their respective cities, used in the .
-   ****: Mock customer data.
    -   **Changes**: Used to populate the customer dropdown in .
-   ****: Mock people data.
    -   **Changes**: Updated company names to match  for auto-fill functionality in . Added more mock entries for .
-   ****: (New File) Utility functions to calculate customer status (active, passive, favorite) based on invoice history.
-   ****: Displays passive customers.
    -   **Changes**: Rewritten to dynamically filter and display customers based on the 6-month no-invoice rule using . Includes statistics cards and filtering options.
-   ****: Displays favorite customers.
    -   **Changes**: Rewritten to dynamically filter and display customers based on the 3+ invoices in 1-year rule using .

</code_architecture>

<pending_tasks>
-   Backend implementation for Sales Opportunities, Customer Prospects, Quotes, Person Management beyond basic CRUD endpoints.
-   Fully implementing  logic to save changes.
-   Further refining the UI of the date picker in .
-   Implementing the email notification system for new user creation.
-   **Handover System Enhancements**: Handover form page (with signature) testing, backend endpoint testing for handovers, email sending tests, automatic survey triggering upon handover completion, and reminder email logic.
-   **Brief System Implementation**: Implement detailed functionality for Tüm Briefler, Kapanmış, Pasif, Brief Talep Et pages beyond initial structure.
-   **New Customer Form Enhancements**: Complete the conditional rendering of Firma Unvanı, Vergi Daireleri (dropdown), and Vergi Numarası fields when Türkiye is selected.
-   **Customer Status Logic**: Connect the customer status calculation with actual backend invoice data once the invoice system is integrated with the backend.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was implementing conditional fields in the Yeni Müşteri Ekle (New Customer Form) in . Specifically, the user requested that when Türkiye is selected as the country, three new fields should appear: Firma Unvanı (Company Title), a dropdown for Vergi Daireleri (Tax Offices), and a textbox for Vergi Numarası (Tax ID). The AI engineer has just started this task, having identified the relevant file and begun adding the necessary state variables for these new fields and defining the list of Turkish tax offices within . This is a continuation of the extensive overhaul of the New Customer Form.
</current_work>

<optional_next_step>
I will implement the conditional rendering of Firma Unvanı, Vergi Daireleri, and Vergi Numarası fields in  based on the selected country being Türkiye.
</optional_next_step>
