<analysis>
The AI engineer's trajectory involved implementing conditional fields for Türkiye in the new customer form, which was confirmed complete after initial testing. However, this revealed a critical authentication bug (), promptly fixed. A subsequent user report exposed that new customers weren't appearing in the list. This led to extensive debugging, first identifying that the customer list was displaying mock data and, more significantly, that the  environment variable was inaccessible in the React production build, causing API call failures. Attempts to resolve this evolved into diagnosing a Kubernetes ingress routing issue, where API requests were misdirected. The latest effort focused on runtime environment variable injection using  and verifying backend accessibility via , indicating a persistent infrastructure-level challenge over simple code bugs.
</analysis>

<product_requirements>
The Vitingo CRM aims for an intuitive, graphic-rich interface, expanding its MVP dashboard. Key requirements include:
1.  **User Management**: Admin-restricted forms, real user data, roles, password changes, actions (Delete, Share, Message, Email), Super Admin Login As.
2.  **Fair Management**: Fuarlar menu with sub-menus and Yeni Fuar form.
3.  **Data Import/Export**: Under Ayarlar with category dropdowns.
4.  **Sales Opportunity Integration**: Dynamic Fuar Adı dropdown in Yeni Satış Fırsatı form.
5.  **Dashboard Redesign**: Modern KPIs, charts, maps, multi-currency, real-time survey stats, relocated logout.
6.  **Customer Survey System**: Post-project surveys with multi-project, arbitrary email, and rep filtering.
7.  **Handover Form System**: Digital forms, language, signature, automatic survey, upon completion.
8.  **Accounting System**: Muhasebe menu, Yeni Fatura form with unique numbering, currency, item lines, KDV, discount, totals, localStorage persistence.
9.  **Messaging System**: In-app messaging, notification bell.
10. **Brief System (New)**: Fully implemented Brief menu with sub-items and a comprehensive Yeni Brief form featuring dynamic customer/contact person selection and auto-fill.
11. **Customer Status Logic (New)**: Pasif (6+ months no invoice) and Favori (3+ invoices in a year) status calculations and display.
12. **New Customer Form Enhancements**: Overhauled form with dynamic İletişim Kişisi, İlişki Tipi, detailed country/city selection, professional phone input. Conditional fields for Türkiye (Firma Unvanı, Vergi Daireleri, Vergi Numarası) are being implemented.
</product_requirements>

<key_technical_concepts>
-   **React**: Frontend framework.
-   **FastAPI/MongoDB**: Backend for API and data persistence (UUIDs for IDs).
-   **Shadcn UI/Tailwind CSS**: UI components and styling.
-   **React Router DOM**: Client-side routing.
-   **Context API**: Global state management (AuthContext).
-   **Frontend Environment Variables**: Proper usage of  (and  / ) for API URLs.
-   **Kubernetes Ingress Routing**: Infrastructure-level routing for API calls.
</key_technical_concepts>

<code_architecture>

-   ****: Handles API endpoints and data processing.
    -   **Changes**: Updated  Pydantic model to include , , and  to support new conditional fields for Turkish customers. Implements comprehensive CRUD endpoints for .
-   ****: Core frontend routing and state management.
    -   **Changes**: Integrated Brief system. Modified  to use backend API. Includes a  to fetch customers from the backend. Critically, updated to use  for environment variable access, and passes  prop to various customer-related pages.
-   ****: Main navigation component.
    -   **Changes**: Added Brief menu items and handlers.
-   ****: (New File) Form for creating new briefs.
    -   **Changes**: Implemented multi-section form with customer/contact person dropdowns and auto-fill.
-   ****: Form for creating new customers.
    -   **Changes**: Major overhaul with dynamic dropdowns, professional phone input, country/city selection. Currently being updated to conditionally render Firma Unvanı, Vergi Daireleri, and Vergi Numarası when Türkiye is selected. State variables and a list of Turkish tax offices were added.
-   ****: Displays all customers.
    -   **Changes**: Modified to receive  as a prop and display real data instead of mock data, fixing a bug where newly added customers weren't visible.
-   ****: Handles user authentication.
    -   **Changes**: Fixed a bug in the  function that was causing authentication failures.
-   ****: (New File) Provides country and city data for the new customer form.
-   ****: (New File) Utility for customer status calculation.
-   ****: (New File) Created for runtime environment variable injection, to store  for the frontend.
-   ****: Main HTML file.
    -   **Changes**: Modified to include  script for runtime environment configuration.
</code_architecture>

<pending_tasks>
-   Backend implementation for Sales Opportunities, Customer Prospects, Quotes, Person Management beyond basic CRUD endpoints.
-   Fully implementing  logic to save changes.
-   Further refining the UI of the date picker in .
-   Implementing the email notification system for new user creation.
-   **Handover System Enhancements**: Handover form page (with signature) testing, backend endpoint testing for handovers, email sending tests, automatic survey triggering upon handover completion, and reminder email logic.
-   **Brief System Implementation**: Implement detailed functionality for Tüm Briefler, Kapanmış, Pasif, Brief Talep Et pages beyond initial structure.
-   **New Customer Form Enhancements**: Address the persistent issue of  inaccessibility and Kubernetes ingress routing.
-   **Customer Status Logic**: Connect the customer status calculation with actual backend invoice data once the invoice system is integrated with the backend.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was deep into diagnosing and resolving critical infrastructure-level issues affecting the frontend-backend communication. The initial task of implementing conditional fields for Türkiye in  was ostensibly completed, but it unveiled a cascade of problems.
First, a  bug in  was fixed, addressing a broken authentication.
Subsequently, a user reported that newly added customers, though seemingly submitted, were not appearing in the . This led to the discovery that  was still using mock data and, more fundamentally, that the  environment variable was not being correctly accessed in the React production build, preventing proper API calls.
The AI engineer attempted several fixes for the environment variable issue (e.g., trying , temporary hardcoding) which eventually revealed a deeper Kubernetes ingress routing problem where  requests intended for the backend were erroneously routed to the frontend.
The latest approach involved implementing runtime environment variable injection by creating , including it in , and updating  to read the  from . The last action was a successful  request to the backend at , confirming the backend is serving data, setting the stage to re-test frontend API access.
</current_work>

<optional_next_step>
Test frontend API access through the application after implementing runtime config injection.
</optional_next_step>

